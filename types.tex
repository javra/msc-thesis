In this this chapter, I will describe how the structures introduced in the previous
chapter can be translated to homotopy type theory.
Besides formulating the concepts using dependent types this involves caring about
the effects of univalence and proof relevance on these definitions.
What does it mean for two instances of a structure to be propositionally equal?
What truncation levels should be imposed on the parameters of said structure
such that algebraic structures bear no unwanted information in their iterated
equality types?

We start off with defining the notion of a categories, and then continue to
translate the definitions from the previous chapter appropriately.
Finally we will show how to apply the definitions to 2-types and define the
fundamental double groupoid and fundamental crossed module of a presented type.

The standard references for the implementation of categories I will use in this
chapter are the respective chapter of the HoTT-Book~\cite{hottbook} as well as
the paper about ``Univalent Categories and the Rezk Completion'' by Benedikt
Ahrens, Chris Kapulkin and Mike Shulman~\cite{rezk-completion}.
While most of the time I will stick to the (consistent) notation and terminology
of both of these, I will deviate sometimes to bring the presentation more
in line with the actual Lean implementation presented in the next chapter.

\section{Categories in HoTT}
% Here goes stuff about univalent vs non-univalent cats
% maybe rezk-completion

\begin{defn}[Precategory] \label{def:hott-precat}
Let $A : \UU$ be a type (the \textbf{object type} or \textbf{carrier}). A
\textbf{precategory} $C$ on $A$ is constructed by giving the following data:
\begin{itemize}
\item For each $a, b : A$ a type of morphisms $\hom_C(a, b) : U$ for which we furthermore
require that $\prod_{(a,b:A)} \isSet(\hom_C(a, b))$.
\item The composition of morphisms
\begin{equation*}
\comp_C : \prod_{a,b,c:A} \hom_C(b, c) \to \hom_C(a, b) \to \hom_C(a, c) \text{.}
\end{equation*}
We will most of the leave the first three arguments implicit and just write
$g \circ_C f$ or $gf$ for $\comp_C(a,b,c,g,f)$.
\item An identity operator $\id_C : \prod_{(a:A)} \hom_C(a,a)$.
\item A witness ensuring associativity for all morphisms:
\begin{equation*}
\prod_{a,b,c,d:A} \prod_{h:\hom_C(c,d)} \prod_{g:\hom_C(b,c)} \prod_{f:\hom_C(a,b)}
h \circ_C (g \circ_C f) = (h \circ_C g) \circ_C f
\end{equation*}
\item Witnesses that the identiy morphisms are neutral with respect to composition
from the left and from the right:
\begin{equation*}
\prod_{a, b : A} \prod_{f : \hom_C(a, b)}
\left(\id_C(b) \circ_C f = f\right) \times \left(f \circ_C \id(a) = f\right)
\end{equation*}
\end{itemize}
\end{defn}

As with all the definitions given in this semi-informal style, it is, from a
theoretical standpoint, equivalent whether to see them as a description of an
iterated $\Sigma$-Type or as the only constructor of an inducitve type.
We will later~\ref{rmk:inductives-not-sigmas} see that in formalization practice
it is favorable to choose to introduce them as new inductive types instead of
$\Sigma$-Types.

We also observe that, since equalities in sets are mere propositions, we have the
following lemma:
\begin{lemma}[Equality of precategories] \label{thm:hott-eq-precat}
Let $C$ and $D$ Precategories on $A$ with $\hom_D :\equiv \hom_C$, 
$\comp_C = \comp_D$ and $\id_C = \id_D$.
Then, $C = D$. \hfill $\qed$
\end{lemma}

This also justifies that we do not require further coherence conditions on
associativity (the ``pentagon coherence'') and identity laws. %TODO add further explanation?

\begin{defn} [Functors] \label{def:hott-precat-functor}
Let $C_A$ and $C_B$ be precategories on types $A$ and $B$.
A \textbf{functor} $F$ between $C_A$ and $C_B$ is constructed by giving the following:
\begin{itemize}
\item Its definition on objects as a instance of $F_{\obj}: A \to B$.
\item Its definition on morphisms
\begin{equation*}
F_{\hom} : \prod_{a,b:A} \prod_{f:\hom_{C_A}(a,b)} \hom_{C_B}(F_{\obj}(a),F_{\obj}(b))\text{.}
\end{equation*}
Again we will often leave out the first two arguments for $F_{\hom}$ and moreover
abbreviating $F_{\hom}$ and $F_{\obj}$ to $F$ whenever the distinction is clear.
\item A proof in $\prod_{(a:A)} F(\id_{C_A}(a)) = \id_{C_B}(F(a))$ that the identies
are preserved and
\item a proof the respects the composition in the respective categories, as an instance
of
\begin{equation*}
\prod_{a,b,c:A} \prod_{g:\hom_{C_A}(b,c)} \prod_{f:\hom_{C_B}(a,b)}
F(g \circ_{C_A} f) = F(g) \circ_{C_B} F(f)
\end{equation*}
\end{itemize}
\end{defn}

Again, the last two ingredients turn out to be mere propositions, as they are
of $\Pi$-types over equalities in sets.
This leads us to the observation that to prove the equality of two functors, it
suffices to check it on their definitions on objects and morphisms:

\begin{lemma}[Equality of functors]
Let $A, B : \UU$ and let $C$, $D$ be categories on $A$ and $B$, respectively.
Let $F$ and $G$ be two functors from $C$ to $D$. If we have
\begin{align*}
p &: \prod_{a:A} F(a) = G(a) \text{ and } \\
q &: \prod_{a,b:A} \prod_{f : \hom_C(a,b)} p(b)_*\left(p(a)_*(F(f))\right) = G(f) \text{,}
\end{align*}
then $F = G$. \hfill $\qed$
\end{lemma}

With this definition of precategories and functors, a lot of structures can be
instantiated as such.
For example, the 1-types of a universe $\UU_i$ give us a precategory with morphisms
between $A, B : \UU_i$ being $A = B$, composition being concatenation of equalities
and identity being reflexivity.
But often we will only have to deal with precategories whose carrier is a set".

\begin{defn}[Strict precategory] \label{def:hott-strict-precat}
A precategory with a set as carrier is called \textbf{strict}.
\end{defn}

One primary use for strict precategories is the following:
If we wanted to build a precategory of precategories we encounter the problem that
functors between two given precategories don't generally form a set!
Restricting ourselves to strict precategories solves this problem:

\begin{lemma}
Let $C$ be a precategory and $D$ be a strict precategory.
Then, the type of functors between $C$ and $D$ forms a set.
\end{lemma}

\begin{proof}
For the type of functors to be a set, all parameters should be sets.
Since the definition on morphisms is a set by definition and,
as we already observed, the identity witnesses are mere propositions,
the only critical parameter is the object function.
But turning the codomain of this function into a set obviously solves the
problem.
\end{proof}

\begin{corollary}
For each pair of universes $(\UU_i, \UU_j)$ there is a precategory of strict
precategories with carrier in $\UU_i$ and morphism types in $\UU_j$. Morphisms of
this category are functors, with composition of functors and identity functors
being defined as obvious. \hfill $\qed$
\end{corollary}

Another precategory we can consider is the precategory of sets:

\begin{lemma}
Let $\UU_i$ be a universe. Then, the type of sets in $\UU_i$ forms a precategory
with morphisms being arbitrary functions.
\end{lemma}

But the truncation level of the carrier is not the only thing that could be bothersome
when dealing with precategories:
If we look at the previous two examples of precategories where each object itself
are types, we can conclude that if two objects are isomorphic in the algebraic sense
they are equivalent types and thus, by the univalence axiom, equal.
We want to transfer this as requirement to all categories, extending the general
idea of univalence which says that isomorphic objects should be treated as equals.
To make this definition of a \emph{category} as smooth as possible, some helping
will be necessary.

\begin{defn}[Isomorphisms]
Let $C$ be a precategory on a type $A : \UU$. A morphism $f : \hom_C(a, b)$ is
called an \textbf{isomorphism} if there is a morphism $g : \hom_C(b,a)$ that
is both a left and a right inverse to $f$.
Define furthermore $a \cong b$ for $a, b : A$ as the type of all isomorphisms in
$\hom_C(a, b)$.
Formally:
\begin{align*}
\isIso_C(f) &:\equiv \sum_{g:\hom_C(b,a)}
	\left(g \circ_C f = \id_C(a)\right) \times \left(f \circ_C g = \id_C(b)\right) \\
a \cong b &:\equiv \sum_{f:\hom_C(b,a)} \isIso_C(f) \text{.}
\end{align*}
\end{defn}

\begin{lemma}
For each $a, b : A$, $a \cong b$ is a set and for each $f : \hom_C(a, b)$,
$\isIso(f)$ is a mere proposition. \hfill $\qed$
\end{lemma}

Equal objects of a category are always isomorphic: %TODO delete this?

\begin{lemma}
If for two objects $a, b : A$ of a precategory $C$ we have $p : a = b$, then there
exists
\begin{equation*}
\idtoiso_{a,b}(p) : a \cong b \text{,}
\end{equation*}
such that $\idtoiso_{a,a}(\refl_a) = \left(\id_C(a),\ldots\right)$. %TODO be sloppier?
\end{lemma}

\begin{proof}
Induction on $p$ lets us assume that $p \equiv \refl_a$. But since
$\id_C(a) \circ_C \id_C(a) = \id_C(a)$ by either of the cancellation laws for
identities, we get an instance of $a \cong a$.
\end{proof}

\begin{defn}[Category]
A \textbf{category} $C$ on $A$ is defined to be a precategory on $A$ extended
by a proof that for all $a, b : A$, $\idtoiso_{a,b}$ is an equivalence.
\end{defn}

\section{Double groupoids in HoTT}

\section{Crossed modules in HoTT}

\section{Presented Types}
% here goes the actual fundamental dbl gpd, xmod

\section{A Seifert-van Kampen theorem for 2-Types}

